<!-- Copyright (C) The IETF Trust (2014) -->
<!-- Copyright (C) The Internet Society (2014) -->

<section anchor="sec:intro" title="Introduction">
  <t>
    Both Parallel Network File System (pNFS) and the File Layout Type
    were defined in the Network File System (NFS) version 4.1
    protocol specification, <xref target='RFC5661' />. The Block
    Layout Type was defined in <xref target='RFC5663' /> and the Object
    Layout Type was in turn defined in <xref target='RFC5664' />.
  </t>

  <t>
    Some implementers have interpreted the text in Sections 12
    ("Parallel NFS (pNFS)") and 13 ("NFSv4.1 as a Storage
    Protocol in pNFS: the File Layout Type") of <xref target='RFC5661' />
    as both being strictly for the File Layout Type. I.e., since
    Section 13 was not covered in a separate RFC like those for
    both the Block and Object Layout Types, there is some confusion
    as to the responsibilities of both the Metadata Server (MDS) and
    the Data Servers (DS) which were laid out in Section 12.
  </t>

  <t>
    As a consequence, new internet drafts (see <xref target='FlexFiles' />
    and <xref target='Lustre' />) may struggle to meet the requirements
    to be a pNFS Layout Type. This document clarifies what are the
    Layout Type independent requirements placed on all Layout Types,
    whether one of the original three or any new variant.
  </t>
</section>

<section anchor='sec:defs' title='Definitions'>
  <t>
    <list style='hanging'>
      <t hangText='control protocol:'>
        is a set of requirements for the communication of information
        on layouts, stateids, file metadata, and file data between
        the metadata server and the storage devices.
      </t>

      <t hangText='Data Server (DS):'>
        is one of the pNFS servers which provide the contents
        of a file system object which is a regular file. Depending
        on the layout, there might be one or more data servers over which
        the data is striped. Note that while the metadata server is strictly
        accessed over the NFSv4.1 protocol, depending on the
        Layout Type, the data server could be accessed via any protocol
        that meets the pNFS requirements.
      </t>

      <t hangText='fencing:'>
        is when the metadata server prevents the storage devices
        from processing I/O from a specific client to a specific file.
      </t>

      <t hangText='layout:'>
        informs a client of which storage devices it needs to communicate
        with (and over which protocol) to perform I/O on a file. The
        layout might also provide some hints about how the storage
        is physically organized.
      </t>

      <t hangText='layout iomode:'>
        describes whether the layout granted to the client is for
        read or read/write I/O.
      </t>

      <t hangText='layout stateid:'>
        is a 128-bit quantity returned by a server that
        uniquely defines the layout state provided by the server
        for a specific layout that describes a Layout Type and
        file (see Section 12.5.2 of <xref target='RFC5661' />).
        Further, Section 12.5.3 describes the difference between
        a layout stateid and a normal stateid.
      </t>

      <t hangText='Layout Type:'>
        describes both the storage protocol used to
        access the data and the aggregation scheme used to lays out
        the file data on the underlying storage devices.
      </t>

      <t hangText='metadata:'>
        is that part of the file system object which describes
        the object and not the payload. E.g., it could be the
        time since last modification, access, etc.
      </t>

      <t hangText='Metadata Server (MDS):'>
        is the pNFS server which provides metadata information
        for a file system object. It also is responsible for
        generating layouts for file system objects. Note that
        the MDS is responsible for directory-based operations.
      </t>

      <t hangText='recalling a layout:'>
        is when the metadata server uses a back channel to inform the client
        that the layout is to be returned in a graceful manner. Note that the client
        could be able to flush any writes, etc., before replying to
        the metadata server.
      </t>

      <t hangText='revoking a layout:'>
        is when the metadata server invalidates the layout such that neither
        the metadata server nor any storage device will accept any access from the client
        with that layout.
      </t>

      <t hangText='stateid:'>
        is a 128-bit quantity returned by a server that
        uniquely defines the open and locking states provided by the
        server for a specific open-owner or lock-owner/open-owner pair for
        a specific file and type of lock.
      </t>

      <t hangText='storage device:'>
        is another term used almost interchangeably with data server. See
        <xref target='sec:intro:diff' /> for the nuances between the two.
      </t>
    </list>
  </t>

  <section anchor='sec:intro:diff' title="Difference Between a Data Server and a Storage Device">
    <t>
      We defined a data server as a pNFS server, which implies that it
      can utilize the NFSv4.1 protocol to communicate with the client.
      As such, only the File Layout Type would currently meet this
      requirement. The more generic concept is a storage device, which
      can use any protocol to communicate with the client. The requirements
      for a storage device to act together with the metadata server
      to provide data to a client are that there is a Layout Type
      specification for the given protocol and that the metadata server
      has granted a layout to the client. Note that nothing precludes
      there being multiple supported Layout Types (i.e., protocols)
      between a metadata server, storage devices, and client.
    </t>

    <t>
      As storage device is the more encompassing terminology, this document
      utilizes it over data server.
    </t>
  </section>

  <section title="Requirements Language">
    <t>
      The key words &quot;MUST&quot;, &quot;MUST NOT&quot;,
      &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
      &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,
      &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be
      interpreted as described in <xref target="RFC2119" />.
    </t>
  </section>
</section>
